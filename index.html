	<!DOCTYPE html>
	<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>College Admission Search</title>
		<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
		<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
		<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
		<style>
			body {
				font-family: 'Roboto', sans-serif;
				background-color: #f4f4f9;
				margin: 0;
				padding: 0;
				display: flex;
				justify-content: center;
				align-items: center;
				min-height: 100vh;
			}
			.container {
				background-color: #ffffff;
				padding: 30px 40px;
				border-radius: 12px;
				box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
				max-width: 90%;
				width: 600px;
				box-sizing: border-box;
			}
			h1 {
				color: #333;
				text-align: center;
				font-size: 1.8rem;
				margin-bottom: 20px;
			}
			form {
				display: flex;
				flex-direction: column;
			}
			.form-row {
				display: flex;
				flex-wrap: wrap;
				gap: 15px;
				margin-bottom: 15px;
			}
			.form-row > div {
				flex: 1;
				min-width: calc(50% - 15px);
			}
			.form-row:nth-child(2) > div {
				min-width: calc(50% - 15px);
			}
			.form-row:nth-child(3) > div {
				min-width: 100%;
			}
			.form-row:nth-child(4) > div {
				min-width: 100%;
			}
			.form-row:nth-child(5) {
		display: flex;
		justify-content: center;
		margin-bottom: 0;
	}
			label {
				font-weight: 500;
				margin-bottom: 5px;
				font-size: 1rem;
				display: block;
			}
			input, select {
				width: 100%;
				padding: 12px;
				border: 1px solid #ddd;
				border-radius: 8px;
				font-size: 1rem;
				box-sizing: border-box;
				margin-bottom: 15px;
			}
			button {
				padding: 12px;
				background-color: #4CAF50;
				color: #ffffff;
				border: none;
				border-radius: 8px;
				cursor: pointer;
				font-size: 1rem;
				transition: background-color 0.3s ease;
			}
			button:hover {
				background-color: #45a049;
			}
			.bottom-link {
				margin-top: 20px;
				text-align: center;
			}
			.bottom-link p {
				margin: 0;
				font-size: 1rem;
				color: #333;
			}
			.link {
				color: #4CAF50;
				text-decoration: none;
				font-weight: bold;
				transition: color 0.3s ease;
			}
			.link:hover {
				color: #45a049;
			}
		   .select2-container {
				width: 100% !important;
			}

			.select2-container--default .select2-selection--single,
			.select2-container--default .select2-selection--multiple {
				height: auto;
				min-height: 45px;
				padding: 5px;
				border-radius: 8px;
				border: 1px solid #ddd;
			}

			.select2-container--default .select2-selection--multiple .select2-selection__rendered {
				padding: 0 5px;
			}

			.select2-container--default .select2-selection--multiple .select2-selection__choice {
				margin-top: 5px;
			}
			.select2-container--default .select2-dropdown {
    z-index: 1000; /* Ensure dropdown is above other elements */
}
			.select2-selection__clear {
				display: none !important;
			}
			@media (max-width: 600px) {
				.container {
					padding: 20px;
					width: 100%;
				}
				h1 {
					font-size: 1.5rem;
				}
				.form-row > div {
					min-width: 100%;
				}
			}
			@media (max-width: 400px) {
				input, select, button {
					font-size: 0.9rem;
					padding: 10px;
				}
			}
		</style>
	</head>
	<body>
		<div class="container">
			<h1>AP EAPCET 2024 First Phase: Last Rank Cutoffs and Opening Ranks for Colleges by Region, Caste, Gender, and Branch</h1>
			<form id="searchForm">
				<div class="form-row">
					<div>
						<label for="rank">Rank (ర్యాంక్):</label>
						<input type="number" id="rank" name="rank" min="1" placeholder="Enter rank (ర్యాంక్ ను నమోదు చేయండి)">
					</div>
					<div>
						<label for="region">Region (ప్రాంతం):</label>
						<select id="region" name="region">
							<option value="">All (అన్ని)</option>
							<option value="AU">AU (ఆంధ్రా విశ్వవిద్యాలయం)</option>
							<option value="SVU">SVU (శ్రీ వెంకటేశ్వర విశ్వవిద్యాలయం)</option>
						</select>
					</div>
				</div>
				<div class="form-row">
					<div>
						<label for="caste">Caste (కులం):</label>
						<select id="caste" name="caste">
							<option value="">All (అన్ని)</option>
							<option value="BC_A">BC_A (బీసీ_A)</option>
							<option value="BC_B">BC_B (బీసీ_B)</option>
							<option value="BC_C">BC_C (బీసీ_C)</option>
							<option value="BC_D">BC_D (బీసీ_D)</option>
							<option value="BC_E">BC_E (బీసీ_E)</option>
							<option value="OC">OC (ఓసి)</option>
							<option value="SC">SC (ఎస్సీ)</option>
							<option value="ST">ST (ఎస్టీ)</option>
							<option value="EWS">EWS (ఈడబ్ల్యూఎస్)</option>
						</select>
					</div>
					<div>
						<label for="category">Category (వర్గం):</label>
						<select id="category" name="category">
							<option value="">All (అన్ని)</option>
							<option value="GEN">Gen</option>
							<option value="GIRLS">Girls</option>
						</select>
					</div>
				</div>
				<div class="form-row">
					<div>
						<label for="branch">Branch (బ్రాంచ్ కోడ్ మరియు పేరు):</label>
						<select id="branch" name="branch" multiple>
							<option value="">All (అన్ని)</option>
							<!-- Additional branch options can be added here -->
						</select>
					</div>
				</div>
				<div class="form-row">
					<div>
						<label for="collegeCode">College Code and Name (కళాశాల కోడ్ మరియు పేరు):</label>
						<select id="collegeCode" name="collegeCode" multiple>
							<option value="">All (అన్ని)</option>
							<!-- Additional college options can be added here -->
						</select>
					</div>
				</div>
				<div class="form-row">
					<button type="submit">Search</button>
				</div>
			</form>
		   <!-- <div class="bottom-link">
				<p style="color: red;">***To View Cutoff Ranks for Special Categories (PWD, SCG, CAP), <a href="http://localhost:8000/others.html" class="link">Click Here</a>.</p>
			</div>-->
		</div>

		<script>
			$(document).ready(function() {
    let data = [];

    function initializeSelect2() {
        $('#branch, #collegeCode').select2({
            placeholder: "Select options",
            allowClear: true,
            width: '100%',
            closeOnSelect: false
        }).on('select2:select', function(e) {
            let selectedValues = $(this).val() || [];
            if (e.params.data.id === '') {
                // If "All" is selected, clear all other selections
                selectedValues = [''];
            } else {
                // Remove "All" if other options are selected
                selectedValues = selectedValues.filter(value => value !== '');
            }
            $(this).val(selectedValues).trigger('change');
            clearSearchTerm($(this));
        }).on('select2:unselect', function(e) {
            let selectedValues = $(this).val() || [];
            if (selectedValues.length === 0) {
                // If no options are selected, select "All"
                $(this).val(['']);
            } else {
                // Ensure "All" is not included if other options are selected
                selectedValues = selectedValues.filter(value => value !== '');
                $(this).val(selectedValues).trigger('change');
            }
            clearSearchTerm($(this));
        });

        // Attach event listeners to handle mouse movement outside
        handleDropdownMouseMovement();
    }

    function clearSearchTerm($select) {
        // Clear search term from the select2 search box
        let $searchField = $select.siblings('.select2-container').find('.select2-search__field');
        if ($searchField.length) {
            $searchField.val('').trigger('input');
        }
    }

    function handleDropdownMouseMovement() {
        $(document).on('mousemove', function(e) {
            if ($('.select2-container--open').length > 0) {
                const $dropdown = $('.select2-container--open');
                const offset = $dropdown.offset();
                const width = $dropdown.outerWidth();
                const height = $dropdown.outerHeight();
                const mouseX = e.pageX;
                const mouseY = e.pageY;

                if (mouseX < offset.left || mouseX > offset.left + width || mouseY < offset.top || mouseY > offset.top + height) {
                    setTimeout(function() {
                        $dropdown.select2('close');
                    }, 100);
                }
            }
        });
    }

    function populateSelect(selectId, options) {
        const select = $(selectId);
        select.empty().append('<option value="">All</option>');
        options.forEach(option => {
            select.append(new Option(option, option));
        });
    }

    function updateFilters() {
        if (data.length === 0) return;

        const collegeCodes = [...new Set(data.map(row => row['College Code__College Name']))];
        const branches = [...new Set(data.map(row => row['Branch Code__Branch Name']))];

        populateSelect('#collegeCode', collegeCodes);
        populateSelect('#branch', branches);

        initializeSelect2();
    }

    function openResultsInNewTab(results) {
        const newTab = window.open('', '_blank');
        if (!newTab) {
            alert("Please allow popups for this site.");
            return;
        }
        newTab.document.write('<html><head><title>Search Results</title>');
        newTab.document.write('<style>table { width: 100%; border-collapse: collapse; } th, td { padding: 12px; text-align: left; border: 1px solid #ddd; } th { background-color: #f4f4f4; font-weight: 500; }</style>');
        newTab.document.write('</head><body>');

        if (results.length === 0) {
            newTab.document.write('<p style="color: red;">No Data Available for the Selected Criteria</p>');
        } else {
            newTab.document.write('<h1>Search Results</h1>');
            newTab.document.write('<table><thead><tr>');
            const headers = Object.keys(results[0]);
            headers.forEach(header => {
                newTab.document.write(`<th>${header}</th>`);
            });
            newTab.document.write('</tr></thead><tbody>');

            results.forEach(row => {
                newTab.document.write('<tr>');
                headers.forEach(header => {
                    newTab.document.write(`<td>${row[header] || ''}</td>`);
                });
                newTab.document.write('</tr>');
            });

            newTab.document.write('</tbody></table>');
        }

        newTab.document.write('</body></html>');
        newTab.document.close();
    }

    // Fetch and parse CSV data
    fetch('Processed_Data14.csv')
        .then(response => response.text())
        .then(csv => {
            Papa.parse(csv, {
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    data = results.data.filter(row => {
                        const Last_Rank = parseFloat(row['Last_Rank']);
                        return !isNaN(Last_Rank) && Last_Rank > 0;
                    });
                    updateFilters();
                }
            });
        });

    // Form submission event
    $('#searchForm').on('submit', function(event) {
        event.preventDefault();

        const rankInput = $('#rank').val().trim();
        const rank = rankInput === '' ? 0 : parseFloat(rankInput);
        const region = $('#region').val().trim();
        const category = $('#category').val().trim();
        const caste = $('#caste').val().trim();
        const branches = $('#branch').val();
        const collegeCodes = $('#collegeCode').val();

        let filteredData = data.filter(row => {
            const lastRank = parseFloat(row['Last_Rank']);
            return (!collegeCodes.length || collegeCodes.includes(row['College Code__College Name'])) &&
                   (!region || region === row['Region']) &&
                   (!caste || caste === row['Caste']) &&
                   (!category || category === row['Category']) &&
                   (!branches.length || branches.includes(row['Branch Code__Branch Name'])) &&
                   (lastRank >= rank);
        });

        openResultsInNewTab(filteredData);
    });
});



		</script>
	</body>
	</html>
